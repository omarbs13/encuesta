SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [Encuesta].[SelEncuesta]
	(
	@cEmail nvarchar(100)
	)
AS
BEGIN

    -- Insert statements for procedure here
    SELECT e.iIdEncuesta, e.cTipEncuesta, e.iCantPregunta, e.cDescripcion, e.bStatus,count(r.iIdRespuesta) Conetestada
    from Encuesta e 
        left join Pregunta p ON 
            e.iIdEncuesta=p.fkEncuesta
        left join SubPregunta sp ON
            p.iIdPregunta = sp.fkPregunta
        left join Respuesta r ON
            sp.iIdSubPregunta   = r.fkSubPregunta
      where r.cEmail=@cEmail or r.cEmail is null
    group by e.iIdEncuesta, e.cTipEncuesta, e.iCantPregunta, e.cDescripcion, e.bStatus
END
GO

